
<div class="container-fluid">
    <div class="row align-items-center mt-5">    
        <div class="col-lg-6 col-sm-12 mx-auto">
            <p class="h1 align-middle text-info">Klar Schiff</p>
            <p class="text-secondary">Suche in <%= current_user.rooms.size %> R채umen, <%= current_user.storages.size %> Ablagen, <%= current_user.items.size %> Dinge, <%= current_user.lists.size %> Listen</p>
        </div>
    </div>
    <div class="row align-items-center mt-3 mb-5">    
        <div class="col-lg-6 col-sm-12 mx-auto">
            <div class="">
                <%= form_with(url: search_search_path, method: :get, local: true) do |form| %>
                    <div class="input-group">
                        <%= form.text_field :search_string, :class=>"form-control form-control-lg" %>
                        <div class="input-group-append">
                            <button class="btn btn-outline-secondary" type="submit"><%= fa_icon "search" %> <span class="d-none d-sm-inline">Suchen</span></button>
                        </b>                        
                    </div>
                <% end %>
            </div>
        </div>
    </div>
</div>

<div class="container">

    <% if (@rooms && @storages && @items && @lists) %>
        <p>
            <i><%= @rooms.size  + @storages.size + @items.size + @lists.size %> Treffer f체r <b><%= params[:search_string] %></b></i>
        </p>
    <% elsif (params[:search_string]) %>
        <p>
            <i>Keine Treffer f체r <b><%= params[:search_string] %></b></i>
        </p>
    <% end %>

    <% if @rooms != nil && @rooms.size > 0 %>
    <h5>R채ume</h5>
    <ul class="list-group">
        <% @rooms.each do |room| %>
            <li class="list-group-item">                
                <%= link_to room, :class => "btn btn-lg btn-outline-primary float-left mr-2" do %><%= fa_icon "angle-right" %><% end %>

                <b>
                    <%= room.name %>
                </b>            

                <% if room.images.first %>
                    <img src="<%= url_for(room.images.first.variant(resize_to_limit: [50, 50], auto_orient: true).processed) %>" class="mr-3 float-right" alt="...">
                <% else %>
                    <img src="https://via.placeholder.com/50x50" class="mr-3 float-right" alt="...">
                <% end %>                 

                <br/>
                <small>
                    </b> Ablagen: <%= link_to room.storages.size, room %>
                </small>
            </li>
        <% end %>
    </ul>
    <% end %>

    <% if @storages && @storages.size > 0 %>
    <h5>Ablagen</h5>
    <ul class="list-group">
        <% @storages.each do |storage| %>
            <li class="list-group-item">
                <%= link_to storage, :class => "btn btn-lg btn-outline-primary float-left mr-2" do %><%= fa_icon "angle-right" %><% end %>

                <b>
                    <%= storage.name %>
                </b>

                <% if storage.images.first %>
                    <img src="<%= url_for(storage.images.first.variant(resize_to_limit: [50, 50], auto_orient: true).processed) %>" class="mr-3 float-right" alt="...">
                <% else %>
                    <img src="https://via.placeholder.com/50x50" class="mr-3 float-right" alt="...">
                <% end %>                

                <br/>
                <small>
                    </b> Raum: <%= link_to storage.room.name, storage.room %>
                </small>
            </li>
        <% end %>
    </ul>
    <% end %>

    <% if @items && @items.size > 0 %>
    <h5>Dinge</h5>
    <ul class="list-group">
        <% @items.each do |item| %>
            <li class="list-group-item">     
            
                <%= link_to item, :class => "btn btn-lg btn-outline-primary float-left mr-2" do %><%= fa_icon "angle-right" %><% end %>
                                    
                <b>
                    <%= klarschiff_auto_link(item.name) %>
                </b>

                <% if item.images.first %>
                    <img src="<%= url_for(item.images.first.variant(resize_to_limit: [50, 50], auto_orient: true).processed) %>" class="mr-3 float-right" alt="...">
                <% else %>
                    <img src="https://via.placeholder.com/50x50" class="mr-3 float-right" alt="...">
                <% end %>

                <br/>
                <small>
                    Ablage: <%= link_to item.storage.name, item.storage %> Raum: <%= link_to item.storage.room.name, item.storage.room %>
                </small>
            </li>
        <% end %>
    </ul>
    <% end %> 
    
    <% if @lists && @lists.size > 0 %>
    <h5>Listen</h5>
    <ul class="list-group">
        <% @lists.each do |list| %>
            <li class="list-group-item">      
                <%= link_to list, :class => "btn btn-lg btn-outline-primary float-left mr-2" do %><%= fa_icon "angle-right" %><% end %>

                <b>
                    <%= list.name %>                        
                </b>

                <% if list.items.first.images.first %>
                    <img src="<%= url_for(list.items.first.images.first.first.variant(resize_to_limit: [50, 50], auto_orient: true).processed) %>" class="mr-3 float-right" alt="...">
                <% else %>
                    <img src="https://via.placeholder.com/50x50" class="mr-3 float-right" alt="...">
                <% end %>
            
                <br/>
                <small>
                    </b> <%= list.list_items.size %> Dinge
                </small>
            </li>
        <% end %>
    </ul>
    <% end %>  
    
    <% if @items_tagged && @items_tagged.size > 0 %>
    <h5>Dinge mit Tag <span class="badge badge-pill badge-light"><i>#<%= params[:search_string] %></i></span></h5>
    <ul class="list-group">
        <% @items_tagged.each do |item| %>
            <li class="list-group-item">                          
                <%= link_to item, :class => "btn btn-lg btn-outline-primary float-left mr-2" do %><%= fa_icon "angle-right" %><% end %>

                <b>
                    <%= klarschiff_auto_link(item.name) %>
                </b>   

                <% if item.images.first %>
                    <img src="<%= url_for(item.images.first.variant(resize_to_limit: [50, 50], auto_orient: true).processed) %>" class="mr-3 float-right" alt="...">
                <% else %>
                    <img src="https://via.placeholder.com/50x50" class="mr-3 float-right" alt="...">
                <% end %>                
                

                <br/>                    
                <small>
                    Ablage: <%= link_to item.storage.name, item.storage %> Raum: <%= link_to item.storage.room.name, item.storage.room %>
                </small>
            </li>
        <% end %>
    </ul>
    <% end %>    

</div>
